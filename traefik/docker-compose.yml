version: '3'
services:
  traefik:
    image: traefik:v2.10  # You can use the latest version
    container_name: traefik
    ports:
      - "80:80"         # HTTP port
      - "443:443"       # HTTPS port
      - "8080:8080"     # Dashboard port
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "/etc/traefik:/etc/traefik"
      - "./letsencrypt:/letsencrypt"
    networks:
      - web
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.go-scratch-app.rule=Host(`traefik.ayetu.net`)"
      - "traefik.http.routers.go-scratch-app.entrypoints=web,websecure"
      - "traefik.http.routers.go-scratch-app.tls=true"
      - "traefik.http.routers.go-scratch-app.tls.certresolver=production"
      # - "traefik.http.middlewares.auth.basicauth.users=admin:$$apr1$$RwVPmt/3$$TUbpmK1PxxIHrlT/Yg3BW."
      # - "traefik.http.routers.dashboard.middlewares=auth"
      - "traefik.http.routers.traefik.service=api@internal"
      - "traefik.http.middlewares.auth.basicauth.users=admin:$$apr1$$RwVPmt/3$$TUbpmK1PxxIHrlT/Yg3BW."

  go-scratch-app:
    image: go-scratch-app  # Replace with your actual Go app image
    container_name: go-scratch-app
    environment:
      - NAME=Will
    networks:
      - web
    ports:
      - "8081:8080"  # Map internal Go app port 8080 to external port 8081
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.go-scratch-app.rule=Host(`go-app.ayetu.net`)"
      - "traefik.http.routers.go-scratch-app.entrypoints=web,websecure"
      - "traefik.http.routers.go-scratch-app.tls=true"
      - "traefik.http.routers.go-scratch-app.tls.certresolver=production"

  nginx:
    image: nginx  
    container_name: nginx
    networks:
      - web
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.nginx.rule=Host(`nginx-traefik.ayetu.net`)"
      - "traefik.http.routers.nginx.entrypoints=web,websecure"
      - "traefik.http.routers.nginx.tls=true"
      - "traefik.http.routers.nginx.tls.certresolver=production"
networks:
  web:
    external: false
